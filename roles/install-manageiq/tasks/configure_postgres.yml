
---
- expect:
    command: sudo passwd postgres
    responses:
      (?i)password: "smartvm"
    

# â†‘ will ask to choose a password
- name: init postgresql db
  shell: >
   postgresql-setup initdb;
   grep -q '^local\s' /var/lib/pgsql/data/pg_hba.conf || echo "local all all trust" | sudo tee -a /var/lib/pgsql/data/pg_hba.conf;
   sed -i.bak 's/\(^local\s*\w*\s*\w*\s*\)\(peer$\)/\1trust/' /var/lib/pgsql/data/pg_hba.conf;
   systemctl enable postgresql;
   systemctl start postgresql;
   su postgres -c "psql -c \"DROP ROLE IF EXISTS root\""
  become: yes
  become_user: root


- name: create postgresql root
  shell: su postgres -c "psql -c \"CREATE ROLE root SUPERUSER LOGIN PASSWORD 'smartvm'\"";
  become: yes
  become_user: root
  ignore_errors: yes  
